- Description architecture:
 ---------------------------

FAI

FIREWALL
DMZ
LAN

LAN:

switch
Routeur en redondance HSRP
switch

server admin 
 syslog
 dhcp
 AD
 stations

Shema.jpg

Plan d'adressage.ods


 Ecoute passive sur un port non configuré:



 Depuis un port LAN utilisateur legitime:
   - obtention d'ip par dhcp: 
      => dns, ad, gw, netmask fournit. 
         Le dns, l'ad et le dhcp sont sur un autre reseau.
   - MIM sur le lan par arp spoofing.
   - usurpation de la gw par defaut:
        arpspoof -t @ip_victime @ip_gw
         , ou sur l'adresse de broadcast pour flouer tout le lan.
        arpspoof -t@broadcast @ip_gw.
 
        activation du routage
            echo 1 >/proc/sys/net/ipv4/ip_forward

      => Capture du traffic sortant et sortant du LAN.  

   Exploitation des protocoles de niveau 2 avec yersinia:
   - CDP: -> dos surcharger de voisins 
   - CDP: fuite d'information sur l'équipement.
   - STP: -> dos par election 
       => Isolation du LAN.

 Depuis un port LAN libre non configuré sur le commutateur:
   - DTP: -> passage du port en mode trunk.
   - Ecoute passsive du traffic:
     Decouverte d'adresse, d'equpipements, de vlans et de protocoles.
     -> Raccordement 802.1q sur les différents vlans du réseau.
    
    - HSRP: Eléction de notre machine comme routeur actif sur l'ensemble des vlans concerné.
      Passage de la machine en routeur, déclaration de la VIP en alias d'interface.
      => capture de l'ensemble du trafic sortant et entrant du reseau interne.
  
   - arpflood avec macof: enregistrement de 17000 entrées: pas de passage en mode HUB, mais DOS


 Reste à faire: 
   capter les logs,
 



 syslog: capture
 dhcp : rogue dhcp


 - Sécurisation:
----------------

FAI

FIREWALL:
   acl, port/dis
DMZ
LAN

LAN:

switch: port/dis, ssh, account, span
Routeur: port/dis, ssh, account, hsrp (auth)

server admin 
 syslog (ssl?)
 dhcp ?
 AD ? 
 stations ?

#  RECONNAISSANCE:

SW2:
  on obtient une adresse DHCP avec:
   10.5.10.1/24
   gw   10.5.10.250
   relay 10.5.10.254
   DNS 10.5.90.1



 capture sur le port 4:

    Analyse: 
       STP:
             src: fe:9e:63:cc:c3:03 , dst: 01:80:c2:00:00:00
             root = fe:9e:63:cc:b7:00, port = 0x8003 cost =4 
       CDP:
             SW2.grp5.forcys :    nom d'hote SW2, nom de domain grp5.forcys         

       DNS:
       10.5.90.1: DNS server

       HSRP:

          10.5.10.253
          10.5.10.254   -> 253 actif


 capture sur le port 21 (libre)

-> flux ipv6


yersinia sur port inutilisé: ça fait rien :D !


























